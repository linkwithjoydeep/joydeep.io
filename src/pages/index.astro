---
import content from "../data/content.json"

import BaseLayout from "../layouts/BaseLayout.astro"
import ThemeSwitcher from "../components/ThemeSwitcher.astro"
import GitHubProjects from "../components/GitHubProjects.astro"

const socialIcons = content.socialIcons as Record<string, { title: string; svg: string }>;
---

<BaseLayout>
  <ThemeSwitcher />
  <div class="container">
    <header>
      <div class="header-content">
        <div class="header-text">
          <h1 class="name">{content.name}</h1>
          <p class="title">{content.title}</p>
          <div class="contact-info">
            <span class="email-wrapper">
              Email: <a href={`mailto:${content.email}`}>{content.email}</a>
              <button class="copy-btn" data-email={content.email} title="Copy email">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16">
                  <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
              <span class="copy-tooltip" id="copyTooltip">Copied!</span>
            </span>
            <span>Location: {content.location}</span>
          </div>
          <div class="social-links">
            {Object.entries(content.social).map(([platform, url]) => (
              <a 
                href={url} 
                target={platform !== 'email' ? '_blank' : undefined}
                class="social-link" 
                title={socialIcons[platform].title}
                aria-label={socialIcons[platform].title}
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d={socialIcons[platform].svg} />
                </svg>
              </a>
            ))}
          </div>
        </div>
        <div class="profile-picture">
          <img src={content.profileImage} alt={content.name}>
        </div>
      </div>
    </header>

    <div class="about-me">
      <h2 class="section-title">About Me</h2>
      <p>{content.about}</p>
    </div>

    <section id="skills">
      <h2 class="section-title">Skills</h2>
      <div class="skills-grid">
      {content.skills.map((skill) => (
        <span class="skill-tag">{skill}</span>
      ))}
      </div>
    </section>

    <section id="experience">
      <h2 class="section-title">Experience</h2>
      {content.experiences.map((experience) => (
      <div class="experience-item">
        <div class="experience-header">
          <h3 class="job-title">{experience.title}</h3>
          <div class="company-period">
            <span class="company">{experience.company}</span>
            <span class="period">{experience.period}</span>
          </div>
        </div>
        <p class="experience-description">
          {experience.description}
        </p>
        <ul class="achievements">
          {experience.achievements.map((achievement) => (
          <li>{achievement}</li>
          ))}
        </ul>
      </div>
      ))}
    </section>

    <section id="recent-work">
      <h2 class="section-title">Recent Work</h2>

      <GitHubProjects repos={content.githubRepos} />

      <div class="view-more-projects">
        <a href={`${content.social.github}?tab=repositories`} target="_blank" class="view-more-link">
          View More on GitHub →
        </a>
      </div>
    </section>

    <section id="education">
      <h2 class="section-title">Education</h2>

      {content.educations.map((education) => (
      <div class="education-item">
        <div class="education-header">
          <h3 class="degree-title">{education.degree}</h3>
          <div class="institution-info">
            <span class="institution">{education.institution}</span>
            {education.credentialUrl && (
            <a href={education.credentialUrl} target="_blank" class="credential-link">
              View Credential →
            </a>
            )}
          </div>
        </div>
      </div>
      ))}
    </section>

    <section id="recommendations">
      <div class="recommendations-content">
        <h2 class="section-title">Recommendations</h2>
        <a href={content.recommendations.url} target="_blank"
          class="recommendations-link">
          {content.recommendations.text}
        </a>
      </div>
    </section>

    <footer>
      <p>
        &copy; {content.footer.copyright}<br>
        {content.footer.madeBy} <a href={content.footer.websiteUrl} target="_blank">{content.name}</a>
      </p>
    </footer>
  </div>
</BaseLayout>

<script is:inline>
  document.addEventListener("click", async (e) => {
    const btn = e.target.closest(".copy-btn");
    if (!btn) return;

    const email = btn.dataset.email;
    const tooltip = document.getElementById("copyTooltip");

    try {
      await navigator.clipboard.writeText(email);

      if (tooltip) {
        tooltip.classList.add("show");

        setTimeout(() => {
          tooltip.classList.remove("show");
        }, 2000);
      }
    } catch (err) {
      console.error("Failed to copy email:", err);

      if (tooltip) {
        tooltip.textContent = "Copy failed";
        tooltip.classList.add("show");

        setTimeout(() => {
          tooltip.classList.remove("show");
          tooltip.textContent = "Copied!";
        }, 2000);
      }
    }
  });
</script>
